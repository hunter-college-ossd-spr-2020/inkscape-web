#!/bin/bash
set -e

mkdir -p data/media

if [[ "$OSTYPE" == "darwin"* ]]; then
  echo "MacOSX is not supported for this website system. Please install VirtualBox or contact the project leader for details."
  exit 1
fi

command -v virtualenv &> /dev/null || {
  command -v apt-get &> /dev/null || {
    echo "I require pythonenv, but it is not installed. Aborting."
    exit 1;
  }
  sudo apt-get install python-virtualenv
}

python ./utils/python-bedeveled || {
  command -v apt-get &> /dev/null || {
    echo "I require python headers, but they are not installed. Aborting."
    exit 1;
  }
  sudo apt-get install python-dev
}

MANAGE="./utils/manage"

# Create tables, migrations etc
./utils/update
# Adds any extra moderator tables the first syncdb missed
./utils/manage syncdb

$MANAGE loaddata dev-auth
echo ""
echo "Default 'admin' user added, password: '123456' (delete on live deployments)"
echo ""

$MANAGE loaddata licenses
$MANAGE loaddata categories
$MANAGE loaddata quota

./utils/refresh-cms #staging. Maybe also add the groups and permissions from live to json file? Would make testing a lot easier.


./utils/refresh-geoip

