{% load i18n static inkscape timers %}

{% if item.is_visible %}
  {% track_object item %}

  <div class="galleryitem{% if not item.published %} unpublished{% endif %}{% if object.contest_finish|totalseconds > 0 and object.winner == item %} winner{% elif object.contest_voting|totalseconds > 0 and item.voted %} voted{% endif %}" 
    title="{{ item.summary_string }}">
    <a class="link" href="{{ item.get_absolute_url }}">
      <img src="{{ item.thumbnail_url }}"/>
    </a>
    <p class="label"><a href="{{ item.get_absolute_url }}">{{ item.name|truncatechars:40 }}</a></p>
    <p class="minitabs">
      {% if request.user.is_authenticated and object.contest_submit %}
        {% if object.user == request.user or object.contest_finish|totalseconds > 0 %}
          {# if object is a gallery, then it's owner can see the contest results #}
          <span class="blank">{{ item.liked }}</span>
        {% else %}
          <span class="blank" title="{% trans "No voting yet." %}">⌛</span>
        {% endif %}
        {% if object.user != request.user and object.contest_voting|totalseconds > 0 and object.contest_finish|totalseconds < 0 %}
          {% if item.voted %}
          <a href="{% url "resource.like" item.pk "-" %}?next={{ request.path }}" class="blank">★</a>
          {% else %}
          <a href="{% url "resource.like" item.pk "+" %}?next={{ request.path }}" class="blank">☆</a>
          {% endif %}
        {% else %}
          {% if item == object.winner %}
          <span class="blank" title="{% trans "Winner of the Contest" %}">{% trans "Win" %}</span>
          {% else %}
            <span class="blank" title="{% trans "Not the Winner" %}">{% trans "Not" %}</span>
          {% endif %}
        {% endif %}
      {% elif item.user == request.user %}
        {% if gallery %}
          <a href="{% url "resource.move" item.pk gallery.pk %}">
            <img src="{% static "mime/banner/move.svg" %}" title="{% trans "Move to Gallery" %}">
          </a>
        {% else %}
          <a href="{% url "resource.copy" item.pk %}">
            <img src="{% static "mime/banner/copy.svg" %}" title="{% trans "Copy to Gallery" %}">
          </a>
        {% endif %}
        <a href="{% url "edit_resource" item.pk %}">
          <img src="{% static "mime/banner/edit.svg" %}" title="{% trans "Edit Resource" %}">
        </a>
      {% else %}
        {% if item.published %}
          <img src="{{ item.mime.banner }}" title="{{ item.mime.subtype }}">
          {% if item.license and item.license.banner %}
            <img src="{{ item.license.banner.url }}" title="{{ item.license }}">
          {% endif %}
        {% endif %}
      {% endif %}
    </p>
  </div>
{% elif not item.is_available %}
  <div class="galleryitem unavailable" title="{{ item.summary_string }}">
    <a class="link" href="{{ item.get_absolute_url }}"><img src="{% static "images/linked-image-not-found.png" %}"/></a>
    <p class="label"><a href="{{ item.get_absolute_url }}">{{ item.name|truncatechars:40 }}</a></p>
    <p class="minitabs"></p>
  </div>
{% endif %}

